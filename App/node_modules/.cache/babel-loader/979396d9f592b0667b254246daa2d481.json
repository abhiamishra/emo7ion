{"ast":null,"code":"export function nonMaxSuppression(boxes, scores, maxOutputSize, iouThreshold, scoreThreshold) {\n  var numBoxes = boxes.shape[0];\n  var outputSize = Math.min(maxOutputSize, numBoxes);\n  var candidates = scores.map(function (score, boxIndex) {\n    return {\n      score: score,\n      boxIndex: boxIndex\n    };\n  }).filter(function (c) {\n    return c.score > scoreThreshold;\n  }).sort(function (c1, c2) {\n    return c2.score - c1.score;\n  });\n\n  var suppressFunc = function (x) {\n    return x <= iouThreshold ? 1 : 0;\n  };\n\n  var selected = [];\n  candidates.forEach(function (c) {\n    if (selected.length >= outputSize) {\n      return;\n    }\n\n    var originalScore = c.score;\n\n    for (var j = selected.length - 1; j >= 0; --j) {\n      var iou = IOU(boxes, c.boxIndex, selected[j]);\n\n      if (iou === 0.0) {\n        continue;\n      }\n\n      c.score *= suppressFunc(iou);\n\n      if (c.score <= scoreThreshold) {\n        break;\n      }\n    }\n\n    if (originalScore === c.score) {\n      selected.push(c.boxIndex);\n    }\n  });\n  return selected;\n}\n\nfunction IOU(boxes, i, j) {\n  var boxesData = boxes.arraySync();\n  var yminI = Math.min(boxesData[i][0], boxesData[i][2]);\n  var xminI = Math.min(boxesData[i][1], boxesData[i][3]);\n  var ymaxI = Math.max(boxesData[i][0], boxesData[i][2]);\n  var xmaxI = Math.max(boxesData[i][1], boxesData[i][3]);\n  var yminJ = Math.min(boxesData[j][0], boxesData[j][2]);\n  var xminJ = Math.min(boxesData[j][1], boxesData[j][3]);\n  var ymaxJ = Math.max(boxesData[j][0], boxesData[j][2]);\n  var xmaxJ = Math.max(boxesData[j][1], boxesData[j][3]);\n  var areaI = (ymaxI - yminI) * (xmaxI - xminI);\n  var areaJ = (ymaxJ - yminJ) * (xmaxJ - xminJ);\n\n  if (areaI <= 0 || areaJ <= 0) {\n    return 0.0;\n  }\n\n  var intersectionYmin = Math.max(yminI, yminJ);\n  var intersectionXmin = Math.max(xminI, xminJ);\n  var intersectionYmax = Math.min(ymaxI, ymaxJ);\n  var intersectionXmax = Math.min(xmaxI, xmaxJ);\n  var intersectionArea = Math.max(intersectionYmax - intersectionYmin, 0.0) * Math.max(intersectionXmax - intersectionXmin, 0.0);\n  return intersectionArea / (areaI + areaJ - intersectionArea);\n}","map":{"version":3,"mappings":"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","names":["nonMaxSuppression","boxes","scores","maxOutputSize","iouThreshold","scoreThreshold","numBoxes","shape","outputSize","Math","min","candidates","map","score","boxIndex","filter","sort","c1","c2","suppressFunc","x","selected","forEach","length","originalScore","c","j","iou","IOU","push","i","boxesData","arraySync","yminI","xminI","ymaxI","max","xmaxI","yminJ","xminJ","ymaxJ","xmaxJ","areaI","areaJ","intersectionYmin","intersectionXmin","intersectionYmax","intersectionXmax","intersectionArea"],"sources":["../../../src/ssdMobilenetv1/nonMaxSuppression.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}