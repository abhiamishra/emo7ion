{"ast":null,"code":"import { getContext2dOrThrow } from '../dom/getContext2dOrThrow';\nimport { resolveInput } from '../dom/resolveInput';\nexport var AnchorPosition;\n\n(function (AnchorPosition) {\n  AnchorPosition[\"TOP_LEFT\"] = \"TOP_LEFT\";\n  AnchorPosition[\"TOP_RIGHT\"] = \"TOP_RIGHT\";\n  AnchorPosition[\"BOTTOM_LEFT\"] = \"BOTTOM_LEFT\";\n  AnchorPosition[\"BOTTOM_RIGHT\"] = \"BOTTOM_RIGHT\";\n})(AnchorPosition || (AnchorPosition = {}));\n\nvar DrawTextFieldOptions =\n/** @class */\nfunction () {\n  function DrawTextFieldOptions(options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    var anchorPosition = options.anchorPosition,\n        backgroundColor = options.backgroundColor,\n        fontColor = options.fontColor,\n        fontSize = options.fontSize,\n        fontStyle = options.fontStyle,\n        padding = options.padding;\n    this.anchorPosition = anchorPosition || AnchorPosition.TOP_LEFT;\n    this.backgroundColor = backgroundColor || 'rgba(0, 0, 0, 0.5)';\n    this.fontColor = fontColor || 'rgba(255, 255, 255, 1)';\n    this.fontSize = fontSize || 14;\n    this.fontStyle = fontStyle || 'Georgia';\n    this.padding = padding || 4;\n  }\n\n  return DrawTextFieldOptions;\n}();\n\nexport { DrawTextFieldOptions };\n\nvar DrawTextField =\n/** @class */\nfunction () {\n  function DrawTextField(text, anchor, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    this.text = typeof text === 'string' ? [text] : text instanceof DrawTextField ? text.text : text;\n    this.anchor = anchor;\n    this.options = new DrawTextFieldOptions(options);\n  }\n\n  DrawTextField.prototype.measureWidth = function (ctx) {\n    var padding = this.options.padding;\n    return this.text.map(function (l) {\n      return ctx.measureText(l).width;\n    }).reduce(function (w0, w1) {\n      return w0 < w1 ? w1 : w0;\n    }, 0) + 2 * padding;\n  };\n\n  DrawTextField.prototype.measureHeight = function () {\n    var _a = this.options,\n        fontSize = _a.fontSize,\n        padding = _a.padding;\n    return this.text.length * fontSize + 2 * padding;\n  };\n\n  DrawTextField.prototype.getUpperLeft = function (ctx, canvasDims) {\n    var anchorPosition = this.options.anchorPosition;\n    var isShiftLeft = anchorPosition === AnchorPosition.BOTTOM_RIGHT || anchorPosition === AnchorPosition.TOP_RIGHT;\n    var isShiftTop = anchorPosition === AnchorPosition.BOTTOM_LEFT || anchorPosition === AnchorPosition.BOTTOM_RIGHT;\n    var textFieldWidth = this.measureWidth(ctx);\n    var textFieldHeight = this.measureHeight();\n    var x = isShiftLeft ? this.anchor.x - textFieldWidth : this.anchor.x;\n    var y = isShiftTop ? this.anchor.y - textFieldHeight : this.anchor.y; // adjust anchor if text box exceeds canvas borders\n\n    if (canvasDims) {\n      var width = canvasDims.width,\n          height = canvasDims.height;\n      var newX = Math.max(Math.min(x, width - textFieldWidth), 0);\n      var newY = Math.max(Math.min(y, height - textFieldHeight), 0);\n      return {\n        x: newX,\n        y: newY\n      };\n    }\n\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  DrawTextField.prototype.draw = function (canvasArg) {\n    var canvas = resolveInput(canvasArg);\n    var ctx = getContext2dOrThrow(canvas);\n    var _a = this.options,\n        backgroundColor = _a.backgroundColor,\n        fontColor = _a.fontColor,\n        fontSize = _a.fontSize,\n        fontStyle = _a.fontStyle,\n        padding = _a.padding;\n    ctx.font = fontSize + \"px \" + fontStyle;\n    var maxTextWidth = this.measureWidth(ctx);\n    var textHeight = this.measureHeight();\n    ctx.fillStyle = backgroundColor;\n    var upperLeft = this.getUpperLeft(ctx, canvas);\n    ctx.fillRect(upperLeft.x, upperLeft.y, maxTextWidth, textHeight);\n    ctx.fillStyle = fontColor;\n    this.text.forEach(function (textLine, i) {\n      var x = padding + upperLeft.x;\n      var y = padding + upperLeft.y + (i + 1) * fontSize;\n      ctx.fillText(textLine, x, y);\n    });\n  };\n\n  return DrawTextField;\n}();\n\nexport { DrawTextField };","map":{"version":3,"mappings":"AACA,SAASA,mBAAT,QAAoC,4BAApC;AACA,SAASC,YAAT,QAA6B,qBAA7B;AAEA,WAAYC,cAAZ;;AAAA,WAAYA,cAAZ,EAA0B;AACxBA;AACAA;AACAA;AACAA;AACD,CALD,EAAYA,cAAc,KAAdA,cAAc,MAA1B;;AAgBA;AAAA;AAAA;AAQE,gCAAYC,OAAZ,EAA+C;AAAnC;AAAAA;AAAmC;;AACrC;AAAA,QAAgBC,yCAAhB;AAAA,QAAiCC,6BAAjC;AAAA,QAA4CC,2BAA5C;AAAA,QAAsDC,6BAAtD;AAAA,QAAiEC,yBAAjE;AACR,SAAKC,cAAL,GAAsBA,cAAc,IAAIP,cAAc,CAACQ,QAAvD;AACA,SAAKN,eAAL,GAAuBA,eAAe,IAAI,oBAA1C;AACA,SAAKC,SAAL,GAAiBA,SAAS,IAAI,wBAA9B;AACA,SAAKC,QAAL,GAAgBA,QAAQ,IAAI,EAA5B;AACA,SAAKC,SAAL,GAAiBA,SAAS,IAAI,SAA9B;AACA,SAAKC,OAAL,GAAeA,OAAO,IAAI,CAA1B;AACD;;AACH;AAAC,CAjBD;;;;AAmBA;AAAA;AAAA;AAKE,yBACEG,IADF,EAEEC,MAFF,EAGET,OAHF,EAGqC;AAAnC;AAAAA;AAAmC;;AAEnC,SAAKQ,IAAL,GAAY,OAAOA,IAAP,KAAgB,QAAhB,GACR,CAACA,IAAD,CADQ,GAEPA,IAAI,YAAYE,aAAhB,GAAgCF,IAAI,CAACA,IAArC,GAA4CA,IAFjD;AAGA,SAAKC,MAAL,GAAcA,MAAd;AACA,SAAKT,OAAL,GAAe,IAAIW,oBAAJ,CAAyBX,OAAzB,CAAf;AACD;;AAEDU,mDAAaE,GAAb,EAA0C;AAChC;AACR,WAAO,KAAKJ,IAAL,CAAUK,GAAV,CAAc,aAAC;AAAI,gBAAG,CAACC,WAAJ,CAAgBC,CAAhB,EAAmBC,KAAnB;AAAwB,KAA3C,EAA6CC,MAA7C,CAAoD,UAACC,EAAD,EAAKC,EAAL,EAAO;AAAK,eAAE,GAAGA,EAAL,GAAUA,EAAV,GAAeD,EAAf;AAAiB,KAAjF,EAAmF,CAAnF,IAAyF,IAAIb,OAApG;AACD,GAHD;;AAKAK;AACQ;AAAA,QAAEP,sBAAF;AAAA,QAAYE,oBAAZ;AACN,WAAO,KAAKG,IAAL,CAAUY,MAAV,GAAmBjB,QAAnB,GAA+B,IAAIE,OAA1C;AACD,GAHD;;AAKAK,mDAAaE,GAAb,EAA4CS,UAA5C,EAAoE;AAC1D;AACR,QAAMC,WAAW,GAAGhB,cAAc,KAAKP,cAAc,CAACwB,YAAlC,IAAkDjB,cAAc,KAAKP,cAAc,CAACyB,SAAxG;AACA,QAAMC,UAAU,GAAGnB,cAAc,KAAKP,cAAc,CAAC2B,WAAlC,IAAiDpB,cAAc,KAAKP,cAAc,CAACwB,YAAtG;AAEA,QAAMI,cAAc,GAAG,KAAKC,YAAL,CAAkBhB,GAAlB,CAAvB;AACA,QAAMiB,eAAe,GAAG,KAAKC,aAAL,EAAxB;AACA,QAAMC,CAAC,GAAIT,WAAW,GAAG,KAAKb,MAAL,CAAYsB,CAAZ,GAAgBJ,cAAnB,GAAoC,KAAKlB,MAAL,CAAYsB,CAAtE;AACA,QAAMC,CAAC,GAAGP,UAAU,GAAG,KAAKhB,MAAL,CAAYuB,CAAZ,GAAgBH,eAAnB,GAAqC,KAAKpB,MAAL,CAAYuB,CAArE,CARkE,CAUlE;;AACA,QAAIX,UAAJ,EAAgB;AACN;AAAA,UAAOY,0BAAP;AACR,UAAMC,IAAI,GAAGC,IAAI,CAACC,GAAL,CAASD,IAAI,CAACE,GAAL,CAASN,CAAT,EAAYf,KAAK,GAAGW,cAApB,CAAT,EAA8C,CAA9C,CAAb;AACA,UAAMW,IAAI,GAAGH,IAAI,CAACC,GAAL,CAASD,IAAI,CAACE,GAAL,CAASL,CAAT,EAAYC,MAAM,GAAGJ,eAArB,CAAT,EAAgD,CAAhD,CAAb;AACA,aAAO;AAAEE,SAAC,EAAEG,IAAL;AAAWF,SAAC,EAAEM;AAAd,OAAP;AACD;;AACD,WAAO;AAAEP,OAAC,GAAH;AAAKC,OAAC;AAAN,KAAP;AACD,GAlBD;;AAoBAtB,2CAAK6B,SAAL,EAAqE;AACnE,QAAMC,MAAM,GAAG1C,YAAY,CAACyC,SAAD,CAA3B;AACA,QAAM3B,GAAG,GAAGf,mBAAmB,CAAC2C,MAAD,CAA/B;AAEM;AAAA,QAAEvC,oCAAF;AAAA,QAAmBC,wBAAnB;AAAA,QAA8BC,sBAA9B;AAAA,QAAwCC,wBAAxC;AAAA,QAAmDC,oBAAnD;AAENO,OAAG,CAAC6B,IAAJ,GAActC,QAAQ,QAAR,GAAcC,SAA5B;AACA,QAAMsC,YAAY,GAAG,KAAKd,YAAL,CAAkBhB,GAAlB,CAArB;AACA,QAAM+B,UAAU,GAAG,KAAKb,aAAL,EAAnB;AAEAlB,OAAG,CAACgC,SAAJ,GAAgB3C,eAAhB;AACA,QAAM4C,SAAS,GAAG,KAAKC,YAAL,CAAkBlC,GAAlB,EAAuB4B,MAAvB,CAAlB;AACA5B,OAAG,CAACmC,QAAJ,CAAaF,SAAS,CAACd,CAAvB,EAA0Bc,SAAS,CAACb,CAApC,EAAuCU,YAAvC,EAAqDC,UAArD;AAEA/B,OAAG,CAACgC,SAAJ,GAAgB1C,SAAhB;AACA,SAAKM,IAAL,CAAUwC,OAAV,CAAkB,UAACC,QAAD,EAAWC,CAAX,EAAY;AAC5B,UAAMnB,CAAC,GAAG1B,OAAO,GAAGwC,SAAS,CAACd,CAA9B;AACA,UAAMC,CAAC,GAAG3B,OAAO,GAAGwC,SAAS,CAACb,CAApB,GAAyB,CAACkB,CAAC,GAAG,CAAL,IAAU/C,QAA7C;AACAS,SAAG,CAACuC,QAAJ,CAAaF,QAAb,EAAuBlB,CAAvB,EAA0BC,CAA1B;AACD,KAJD;AAKD,GApBD;;AAqBF;AAAC,CApED","names":["getContext2dOrThrow","resolveInput","AnchorPosition","options","backgroundColor","fontColor","fontSize","fontStyle","padding","anchorPosition","TOP_LEFT","text","anchor","DrawTextField","DrawTextFieldOptions","ctx","map","measureText","l","width","reduce","w0","w1","length","canvasDims","isShiftLeft","BOTTOM_RIGHT","TOP_RIGHT","isShiftTop","BOTTOM_LEFT","textFieldWidth","measureWidth","textFieldHeight","measureHeight","x","y","height","newX","Math","max","min","newY","canvasArg","canvas","font","maxTextWidth","textHeight","fillStyle","upperLeft","getUpperLeft","fillRect","forEach","textLine","i","fillText"],"sources":["../../../src/draw/DrawTextField.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}