{"ast":null,"code":"import { disposeUnusedWeightTensors, extractWeightEntryFactory } from '../common';\nimport { isTensor3D } from '../utils';\n\nfunction extractorsFactory(weightMap, paramMappings) {\n  var extractWeightEntry = extractWeightEntryFactory(weightMap, paramMappings);\n\n  function extractPointwiseConvParams(prefix, idx, mappedPrefix) {\n    var filters = extractWeightEntry(prefix + \"/Conv2d_\" + idx + \"_pointwise/weights\", 4, mappedPrefix + \"/filters\");\n    var batch_norm_offset = extractWeightEntry(prefix + \"/Conv2d_\" + idx + \"_pointwise/convolution_bn_offset\", 1, mappedPrefix + \"/batch_norm_offset\");\n    return {\n      filters: filters,\n      batch_norm_offset: batch_norm_offset\n    };\n  }\n\n  function extractConvPairParams(idx) {\n    var mappedPrefix = \"mobilenetv1/conv_\" + idx;\n    var prefixDepthwiseConv = \"MobilenetV1/Conv2d_\" + idx + \"_depthwise\";\n    var mappedPrefixDepthwiseConv = mappedPrefix + \"/depthwise_conv\";\n    var mappedPrefixPointwiseConv = mappedPrefix + \"/pointwise_conv\";\n    var filters = extractWeightEntry(prefixDepthwiseConv + \"/depthwise_weights\", 4, mappedPrefixDepthwiseConv + \"/filters\");\n    var batch_norm_scale = extractWeightEntry(prefixDepthwiseConv + \"/BatchNorm/gamma\", 1, mappedPrefixDepthwiseConv + \"/batch_norm_scale\");\n    var batch_norm_offset = extractWeightEntry(prefixDepthwiseConv + \"/BatchNorm/beta\", 1, mappedPrefixDepthwiseConv + \"/batch_norm_offset\");\n    var batch_norm_mean = extractWeightEntry(prefixDepthwiseConv + \"/BatchNorm/moving_mean\", 1, mappedPrefixDepthwiseConv + \"/batch_norm_mean\");\n    var batch_norm_variance = extractWeightEntry(prefixDepthwiseConv + \"/BatchNorm/moving_variance\", 1, mappedPrefixDepthwiseConv + \"/batch_norm_variance\");\n    return {\n      depthwise_conv: {\n        filters: filters,\n        batch_norm_scale: batch_norm_scale,\n        batch_norm_offset: batch_norm_offset,\n        batch_norm_mean: batch_norm_mean,\n        batch_norm_variance: batch_norm_variance\n      },\n      pointwise_conv: extractPointwiseConvParams('MobilenetV1', idx, mappedPrefixPointwiseConv)\n    };\n  }\n\n  function extractMobilenetV1Params() {\n    return {\n      conv_0: extractPointwiseConvParams('MobilenetV1', 0, 'mobilenetv1/conv_0'),\n      conv_1: extractConvPairParams(1),\n      conv_2: extractConvPairParams(2),\n      conv_3: extractConvPairParams(3),\n      conv_4: extractConvPairParams(4),\n      conv_5: extractConvPairParams(5),\n      conv_6: extractConvPairParams(6),\n      conv_7: extractConvPairParams(7),\n      conv_8: extractConvPairParams(8),\n      conv_9: extractConvPairParams(9),\n      conv_10: extractConvPairParams(10),\n      conv_11: extractConvPairParams(11),\n      conv_12: extractConvPairParams(12),\n      conv_13: extractConvPairParams(13)\n    };\n  }\n\n  function extractConvParams(prefix, mappedPrefix) {\n    var filters = extractWeightEntry(prefix + \"/weights\", 4, mappedPrefix + \"/filters\");\n    var bias = extractWeightEntry(prefix + \"/biases\", 1, mappedPrefix + \"/bias\");\n    return {\n      filters: filters,\n      bias: bias\n    };\n  }\n\n  function extractBoxPredictorParams(idx) {\n    var box_encoding_predictor = extractConvParams(\"Prediction/BoxPredictor_\" + idx + \"/BoxEncodingPredictor\", \"prediction_layer/box_predictor_\" + idx + \"/box_encoding_predictor\");\n    var class_predictor = extractConvParams(\"Prediction/BoxPredictor_\" + idx + \"/ClassPredictor\", \"prediction_layer/box_predictor_\" + idx + \"/class_predictor\");\n    return {\n      box_encoding_predictor: box_encoding_predictor,\n      class_predictor: class_predictor\n    };\n  }\n\n  function extractPredictionLayerParams() {\n    return {\n      conv_0: extractPointwiseConvParams('Prediction', 0, 'prediction_layer/conv_0'),\n      conv_1: extractPointwiseConvParams('Prediction', 1, 'prediction_layer/conv_1'),\n      conv_2: extractPointwiseConvParams('Prediction', 2, 'prediction_layer/conv_2'),\n      conv_3: extractPointwiseConvParams('Prediction', 3, 'prediction_layer/conv_3'),\n      conv_4: extractPointwiseConvParams('Prediction', 4, 'prediction_layer/conv_4'),\n      conv_5: extractPointwiseConvParams('Prediction', 5, 'prediction_layer/conv_5'),\n      conv_6: extractPointwiseConvParams('Prediction', 6, 'prediction_layer/conv_6'),\n      conv_7: extractPointwiseConvParams('Prediction', 7, 'prediction_layer/conv_7'),\n      box_predictor_0: extractBoxPredictorParams(0),\n      box_predictor_1: extractBoxPredictorParams(1),\n      box_predictor_2: extractBoxPredictorParams(2),\n      box_predictor_3: extractBoxPredictorParams(3),\n      box_predictor_4: extractBoxPredictorParams(4),\n      box_predictor_5: extractBoxPredictorParams(5)\n    };\n  }\n\n  return {\n    extractMobilenetV1Params: extractMobilenetV1Params,\n    extractPredictionLayerParams: extractPredictionLayerParams\n  };\n}\n\nexport function extractParamsFromWeigthMap(weightMap) {\n  var paramMappings = [];\n\n  var _a = extractorsFactory(weightMap, paramMappings),\n      extractMobilenetV1Params = _a.extractMobilenetV1Params,\n      extractPredictionLayerParams = _a.extractPredictionLayerParams;\n\n  var extra_dim = weightMap['Output/extra_dim'];\n  paramMappings.push({\n    originalPath: 'Output/extra_dim',\n    paramPath: 'output_layer/extra_dim'\n  });\n\n  if (!isTensor3D(extra_dim)) {\n    throw new Error(\"expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have \" + extra_dim);\n  }\n\n  var params = {\n    mobilenetv1: extractMobilenetV1Params(),\n    prediction_layer: extractPredictionLayerParams(),\n    output_layer: {\n      extra_dim: extra_dim\n    }\n  };\n  disposeUnusedWeightTensors(weightMap, paramMappings);\n  return {\n    params: params,\n    paramMappings: paramMappings\n  };\n}","map":{"version":3,"mappings":"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","names":["disposeUnusedWeightTensors","extractWeightEntryFactory","isTensor3D","extractorsFactory","weightMap","paramMappings","extractWeightEntry","extractPointwiseConvParams","prefix","idx","mappedPrefix","filters","batch_norm_offset","extractConvPairParams","prefixDepthwiseConv","mappedPrefixDepthwiseConv","mappedPrefixPointwiseConv","batch_norm_scale","batch_norm_mean","batch_norm_variance","depthwise_conv","pointwise_conv","extractMobilenetV1Params","conv_0","conv_1","conv_2","conv_3","conv_4","conv_5","conv_6","conv_7","conv_8","conv_9","conv_10","conv_11","conv_12","conv_13","extractConvParams","bias","extractBoxPredictorParams","box_encoding_predictor","class_predictor","extractPredictionLayerParams","box_predictor_0","box_predictor_1","box_predictor_2","box_predictor_3","box_predictor_4","box_predictor_5","extractParamsFromWeigthMap","extra_dim","push","originalPath","paramPath","Error","params","mobilenetv1","prediction_layer","output_layer"],"sources":["../../../src/ssdMobilenetv1/extractParamsFromWeigthMap.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}