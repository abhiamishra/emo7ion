{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport * as tf from '@tensorflow/tfjs-core';\nimport { toNetInput } from '../dom';\nimport { FaceFeatureExtractor } from '../faceFeatureExtractor/FaceFeatureExtractor';\nimport { FaceProcessor } from '../faceProcessor/FaceProcessor';\nimport { FaceExpressions } from './FaceExpressions';\n\nvar FaceExpressionNet =\n/** @class */\nfunction (_super) {\n  __extends(FaceExpressionNet, _super);\n\n  function FaceExpressionNet(faceFeatureExtractor) {\n    if (faceFeatureExtractor === void 0) {\n      faceFeatureExtractor = new FaceFeatureExtractor();\n    }\n\n    return _super.call(this, 'FaceExpressionNet', faceFeatureExtractor) || this;\n  }\n\n  FaceExpressionNet.prototype.forwardInput = function (input) {\n    var _this = this;\n\n    return tf.tidy(function () {\n      return tf.softmax(_this.runNet(input));\n    });\n  };\n\n  FaceExpressionNet.prototype.forward = function (input) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = this.forwardInput;\n            return [4\n            /*yield*/\n            , toNetInput(input)];\n\n          case 1:\n            return [2\n            /*return*/\n            , _a.apply(this, [_b.sent()])];\n        }\n      });\n    });\n  };\n\n  FaceExpressionNet.prototype.predictExpressions = function (input) {\n    return __awaiter(this, void 0, void 0, function () {\n      var netInput, out, probabilitesByBatch, predictionsByBatch;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , toNetInput(input)];\n\n          case 1:\n            netInput = _a.sent();\n            return [4\n            /*yield*/\n            , this.forwardInput(netInput)];\n\n          case 2:\n            out = _a.sent();\n            return [4\n            /*yield*/\n            , Promise.all(tf.unstack(out).map(function (t) {\n              return __awaiter(_this, void 0, void 0, function () {\n                var data;\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4\n                      /*yield*/\n                      , t.data()];\n\n                    case 1:\n                      data = _a.sent();\n                      t.dispose();\n                      return [2\n                      /*return*/\n                      , data];\n                  }\n                });\n              });\n            }))];\n\n          case 3:\n            probabilitesByBatch = _a.sent();\n            out.dispose();\n            predictionsByBatch = probabilitesByBatch.map(function (probabilites) {\n              return new FaceExpressions(probabilites);\n            });\n            return [2\n            /*return*/\n            , netInput.isBatchInput ? predictionsByBatch : predictionsByBatch[0]];\n        }\n      });\n    });\n  };\n\n  FaceExpressionNet.prototype.getDefaultModelName = function () {\n    return 'face_expression_model';\n  };\n\n  FaceExpressionNet.prototype.getClassifierChannelsIn = function () {\n    return 256;\n  };\n\n  FaceExpressionNet.prototype.getClassifierChannelsOut = function () {\n    return 7;\n  };\n\n  return FaceExpressionNet;\n}(FaceProcessor);\n\nexport { FaceExpressionNet };","map":{"version":3,"mappings":";AAAA,OAAO,KAAKA,EAAZ,MAAoB,uBAApB;AAEA,SAA8BC,UAA9B,QAAgD,QAAhD;AACA,SAASC,oBAAT,QAAqC,8CAArC;AAEA,SAASC,aAAT,QAA8B,gCAA9B;AACA,SAASC,eAAT,QAAgC,mBAAhC;;AAEA;AAAA;AAAA;AAAuCC;;AAErC,6BAAYC,oBAAZ,EAAmF;AAAvE;AAAAA,iCAAiDJ,oBAAjD;AAAuE;;WACjFK,kBAAM,mBAAN,EAA2BD,oBAA3B,KAAgD;AACjD;;AAEME,6CAAP,UAAoBC,KAApB,EAAiD;AAAjD;;AACE,WAAOT,EAAE,CAACU,IAAH,CAAQ;AAAM,eAAE,CAACC,OAAH,CAAWC,KAAI,CAACC,MAAL,CAAYJ,KAAZ,CAAX;AAA8B,KAA5C,CAAP;AACD,GAFM;;AAIMD,wCAAb,UAAqBC,KAArB,EAAqC;;;;;;;AAC5BK,sBAAKC,YAAL;AAAkB;AAAA;AAAA,cAAMd,UAAU,CAACQ,KAAD,CAAhB;;;AAAzB;AAAA;AAAA,cAAOK,eAAI,CAAcE,SAAd,CAAJ,CAAP;;;;AACD,GAFY;;AAIAR,mDAAb,UAAgCC,KAAhC,EAAgD;;;;;;;;;AAC7B;AAAA;AAAA,cAAMR,UAAU,CAACQ,KAAD,CAAhB;;;AAAXQ,oBAAQ,GAAGH,SAAX;AACM;AAAA;AAAA,cAAM,KAAKC,YAAL,CAAkBE,QAAlB,CAAN;;;AAANC,eAAG,GAAGJ,SAAN;AACsB;AAAA;AAAA,cAAMK,OAAO,CAACC,GAAR,CAAYpB,EAAE,CAACqB,OAAH,CAAWH,GAAX,EAAgBI,GAAhB,CAAoB,UAAMC,CAAN,EAAO;AAAA;;;;;AAC1D;AAAA;AAAA,wBAAMA,CAAC,CAACC,IAAF,EAAN;;;AAAPA,0BAAI,GAAGV,SAAP;AACNS,uBAAC,CAACE,OAAF;AACA;AAAA;AAAA,wBAAOD,IAAP;;;eAHuE;AAIxE,aAJ6C,CAAZ,CAAN;;;AAAtBE,+BAAmB,GAAGZ,SAAtB;AAKNI,eAAG,CAACO,OAAJ;AAEME,8BAAkB,GAAGD,mBAAmB,CAC3CJ,GADwB,CACpB,wBAAY;AAAI,yBAAIlB,eAAJ,CAAoBwB,YAApB;AAAiD,aAD7C,CAArB;AAGN;AAAA;AAAA,cAAOX,QAAQ,CAACY,YAAT,GACHF,kBADG,GAEHA,kBAAkB,CAAC,CAAD,CAFtB;;;;AAGD,GAhBY;;AAkBHnB,oDAAV;AACE,WAAO,uBAAP;AACD,GAFS;;AAIAA,wDAAV;AACE,WAAO,GAAP;AACD,GAFS;;AAIAA,yDAAV;AACE,WAAO,CAAP;AACD,GAFS;;AAGZ;AA3CA,EAAuCL,aAAvC","names":["tf","toNetInput","FaceFeatureExtractor","FaceProcessor","FaceExpressions","__extends","faceFeatureExtractor","_super","FaceExpressionNet","input","tidy","softmax","_this","runNet","_a","forwardInput","_b","netInput","out","Promise","all","unstack","map","t","data","dispose","probabilitesByBatch","predictionsByBatch","probabilites","isBatchInput"],"sources":["../../../src/faceExpressionNet/FaceExpressionNet.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}